Poj3567	eng	N	Y	O	B-OJ
/	x	N	N	O	O
Bzoj1023	eng	N	Y	O	B-OJ

Cactus	eng	N	N	O	O

仙人掌	n	Y	N	O	O
图	n	N	N	O	I-KNOWLEDGE
的	uj	N	N	O	O
直径	n	Y	N	O	O

|	x	N	N	O	O

[	x	N	N	O	O
IOI2008	eng	N	N	O	O
]	x	N	N	O	O

Island	eng	N	N	O	O

-	x	N	N	O	O
-	x	N	N	O	O
-	x	N	N	O	O
树上	s	N	N	O	O
DP	eng	N	N	O	B-KNOWLEDGE
+	x	N	N	O	O
环上	n	Y	N	O	O
单调	n	Y	N	O	B-KNOWLEDGE
队列	n	Y	N	O	I-KNOWLEDGE
_	x	N	N	O	O
Poetize	eng	N	N	O	O

Space	eng	N	N	O	O
_	x	N	N	O	O
百度	n	N	N	O	O
空间	n	N	N	O	O

这	r	N	N	O	O
两个	m	N	N	O	O
题	n	N	N	O	O
主体	n	N	N	O	O
思路	n	N	N	O	O
差不多	l	N	N	O	O
，	x	N	N	O	O
都	d	N	N	O	O
是	v	N	N	O	O
在	p	N	N	O	O
树上	s	N	N	O	O
树状	n	Y	N	O	O
DP	eng	N	N	O	B-KNOWLEDGE
、	x	N	N	O	O
环上	n	Y	N	O	O
单调	n	Y	N	O	B-KNOWLEDGE
队列	n	Y	N	O	I-KNOWLEDGE
优化	vn	Y	N	O	O
的	uj	N	N	O	O
DP	eng	N	N	O	B-KNOWLEDGE
。	x	N	N	O	O

只不过	c	N	N	O	O
前者	n	N	N	O	O
的	uj	N	N	O	O
图	n	N	N	O	O
是	v	N	N	O	O
一棵	m	N	N	O	O
仙人掌	n	Y	N	O	O
，	x	N	N	O	O
后者	n	N	N	O	O
的	uj	N	N	O	O
图	n	N	N	O	O
是	v	N	N	O	O
一棵	m	N	N	O	O
外	f	N	N	O	O
/	x	N	N	O	O
内向	n	N	N	O	O
树	v	N	N	O	O
。	x	N	N	O	O

前者	n	N	N	O	O
题目	n	Y	N	O	O
描述	v	N	N	O	O
很	zg	N	N	O	O
直接	ad	N	N	O	O
：	x	N	N	O	O
求	v	N	N	O	O
仙人掌	n	Y	N	O	O
直径	n	Y	N	O	O
；	x	N	N	O	O
后者	n	N	N	O	O
仔细分析	n	N	N	O	O
可以	c	N	N	O	O
发现	v	N	N	O	O
，	x	N	N	O	O
答案	n	N	N	O	O
就是	d	N	N	O	O
各个	r	N	N	O	O
连通	a	Y	N	O	O
分量	n	Y	N	O	O
内	n	N	N	O	O
最长	a	Y	N	O	O
链	ng	N	N	O	O
之	u	N	N	O	O
和	c	N	N	O	O
。	x	N	N	O	O

设	n	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
表示	v	Y	N	O	O
点	m	N	N	O	O
i	eng	N	N	O	O
为	p	N	N	O	O
根	q	N	N	O	O
的	uj	N	N	O	O
子树	n	N	N	O	O
中	f	N	N	O	O
最长	a	Y	N	O	O
链	ng	N	N	O	O
有	v	N	N	O	O
多长	n	N	N	O	O
。	x	N	N	O	O

对于	p	N	N	O	O
这	r	N	N	O	O
两个	m	N	N	O	O
题	n	N	N	O	O
，	x	N	N	O	O
图	n	N	N	O	O
中	f	N	N	O	O
的	uj	N	N	O	O
边	n	N	N	O	O
实际上	d	N	N	O	O
只有	c	N	N	O	O
两种	m	N	N	O	O
：	x	N	N	O	O
1.	m	N	N	O	O
割	v	N	N	O	O
边	d	N	N	O	O
，	x	N	N	O	O
也	d	N	N	O	O
就是	d	N	N	O	O
在	p	N	N	O	O
树上	s	N	N	O	O
的	uj	N	N	O	O
边	n	N	N	O	O
。	x	N	N	O	O

2.	m	N	N	O	O
非	d	N	N	O	O
割	v	N	N	O	O
边	d	N	N	O	O
，	x	N	N	O	O
也	d	N	N	O	O
就是	d	N	N	O	O
在	p	N	N	O	O
环上	n	Y	N	O	O
的	uj	N	N	O	O
边	n	N	N	O	O
（	x	N	N	O	O
双	n	N	N	O	O
连通	a	Y	N	O	O
分量	n	Y	N	O	O
内部	f	Y	N	O	O
的	uj	N	N	O	O
边	n	N	N	O	O
）	x	N	N	O	O
。	x	N	N	O	O

对于	p	N	N	O	O
割	v	N	N	O	O
边	d	N	N	O	O
(	x	N	N	O	O
u	x	N	N	O	O
,	x	N	N	O	O
v	x	N	N	O	O
)	x	N	N	O	O
，	x	N	N	O	O
如果	c	N	N	O	O
u	eng	N	N	O	O
是	v	N	N	O	O
v	eng	N	N	O	O
的	uj	N	N	O	O
父亲	n	N	N	O	O
，	x	N	N	O	O
首先	d	N	N	O	O
用	p	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
v	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
w	eng	N	N	O	O
(	x	N	N	O	O
u	x	N	N	O	O
,	x	N	N	O	O
v	x	N	N	O	O
)	x	N	N	O	O
更新	d	N	N	O	O
ans	eng	N	N	O	O
，	x	N	N	O	O
因为	c	N	N	O	O
此时	c	N	N	O	O
还	d	N	N	O	O
没有	v	N	N	O	O
用	p	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
v	x	N	N	O	O
]	x	N	N	O	O
更新	d	N	N	O	O
F	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
，	x	N	N	O	O
所以	c	N	N	O	O
F	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
一定	d	N	N	O	O
是从	v	N	N	O	O
另	r	N	N	O	O
一个	m	N	N	O	O
儿子	n	N	N	O	O
转移	v	N	N	O	O
来	v	N	N	O	O
的	uj	N	N	O	O
；	x	N	N	O	O
然后	c	N	N	O	O
再	d	N	N	O	O
用	p	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
v	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
w	eng	N	N	O	O
(	x	N	N	O	O
u	x	N	N	O	O
,	x	N	N	O	O
v	x	N	N	O	O
)	x	N	N	O	O
更新	d	N	N	O	O
F	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
。	x	N	N	O	O

对于	p	N	N	O	O
环上	n	Y	N	O	O
两点	m	N	N	O	O
(	x	N	N	O	O
u	x	N	N	O	O
,	x	N	N	O	O
v	x	N	N	O	O
)	x	N	N	O	O
，	x	N	N	O	O
我们	r	N	N	O	O
用	p	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
v	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
dist	eng	N	N	O	O
(	x	N	N	O	O
u	x	N	N	O	O
,	x	N	N	O	O
v	x	N	N	O	O
)	x	N	N	O	O
更新	d	N	N	O	O
ans	eng	N	N	O	O
，	x	N	N	O	O
对于	p	N	N	O	O
Cactus	eng	N	N	O	O
一题	n	N	N	O	O
，	x	N	N	O	O
还要	c	N	N	O	O
用	p	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
v	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
dist	eng	N	N	O	O
(	x	N	N	O	O
u	x	N	N	O	O
,	x	N	N	O	O
v	x	N	N	O	O
)	x	N	N	O	O
更新	d	N	N	O	O
某个	r	N	N	O	O
环	v	N	N	O	O
在	p	N	N	O	O
DFS	eng	N	N	O	O
树上	s	N	N	O	O
的	uj	N	N	O	O
最高点	n	N	N	O	O
u	x	N	N	O	O
。	x	N	N	O	O

Cactus	eng	N	N	O	O
这	r	N	N	O	O
题	n	N	N	O	O
，	x	N	N	O	O
我们	r	N	N	O	O
需要	v	N	N	O	O
在	p	N	N	O	O
Tarjan	eng	N	N	O	O
的	uj	N	N	O	O
过程	n	N	N	O	O
中	f	N	N	O	O
找出	v	Y	N	O	O
割	v	N	N	O	O
边	d	N	N	O	O
并且	c	N	N	O	O
用	p	N	N	O	O
上述	b	N	N	O	O
方法	n	Y	N	O	O
更新	d	N	N	O	O
，	x	N	N	O	O
同时	c	N	N	O	O
找出	v	Y	N	O	O
所有	b	N	N	O	O
的	uj	N	N	O	O
环	n	N	N	O	O
，	x	N	N	O	O
当	t	N	N	O	O
这个	r	N	N	O	O
环上	n	Y	N	O	O
的	uj	N	N	O	O
所有	b	N	N	O	O
点	m	N	N	O	O
的	uj	N	N	O	O
F	eng	N	N	O	O
[	x	N	N	O	O
]	x	N	N	O	O
值	n	N	N	O	O
都	d	N	N	O	O
被	p	N	N	O	O
更新	d	N	N	O	O
完	v	N	N	O	O
之后	f	N	N	O	O
，	x	N	N	O	O
立即	d	N	N	O	O
对	p	N	N	O	O
这个	r	N	N	O	O
环	v	N	N	O	O
进行	v	N	N	O	O
处理	v	N	N	O	O
。	x	N	N	O	O

具体做法	v	N	N	O	O
是	v	N	N	O	O
：	x	N	N	O	O
对于	p	N	N	O	O
一个点	m	N	N	O	O
x	x	N	N	O	O
，	x	N	N	O	O
如果	c	N	N	O	O
存在	v	N	N	O	O
一条	m	N	N	O	O
边	d	N	N	O	O
(	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
)	x	N	N	O	O
，	x	N	N	O	O
并且	c	N	N	O	O
在	p	N	N	O	O
DFS	eng	N	N	O	O
树中	s	N	N	O	O
x	eng	N	N	O	O
不是	c	N	N	O	O
y	eng	N	N	O	O
的	uj	N	N	O	O
父亲	n	N	N	O	O
，	x	N	N	O	O
并且	c	N	N	O	O
dfn	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
<	x	N	N	O	O
dfn	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
，	x	N	N	O	O
说明	v	N	N	O	O
x	eng	N	N	O	O
和	c	N	N	O	O
y	eng	N	N	O	O
是	v	N	N	O	O
一个	m	N	N	O	O
环上	n	Y	N	O	O
两个	m	N	N	O	O
相邻	v	N	N	O	O
的	uj	N	N	O	O
点	m	N	N	O	O
，	x	N	N	O	O
并且	c	N	N	O	O
在	p	N	N	O	O
DFS	eng	N	N	O	O
树中	s	N	N	O	O
二者	n	N	N	O	O
没有	v	N	N	O	O
相邻	v	N	N	O	O
，	x	N	N	O	O
因此	c	N	N	O	O
此时	c	N	N	O	O
环上	n	Y	N	O	O
(	x	N	N	O	O
x	x	N	N	O	O
…	x	N	N	O	O
…	x	N	N	O	O
y	x	N	N	O	O
)	x	N	N	O	O
这些	r	N	N	O	O
点	m	N	N	O	O
都	d	N	N	O	O
已经	d	N	N	O	O
DFS	eng	N	N	O	O
过	ug	N	N	O	O
了	ul	N	N	O	O
，	x	N	N	O	O
就	d	N	N	O	O
可以	c	N	N	O	O
对	p	N	N	O	O
这个	r	N	N	O	O
环	v	N	N	O	O
进行	v	N	N	O	O
处理	v	N	N	O	O
了	ul	N	N	O	O
。	x	N	N	O	O

Island	eng	N	N	O	O
这	r	N	N	O	O
题	n	N	N	O	O
，	x	N	N	O	O
首先	d	N	N	O	O
遍历	v	Y	N	O	O
一遍	m	N	N	O	O
图	n	N	N	O	O
，	x	N	N	O	O
找出	v	Y	N	O	O
各个	r	N	N	O	O
连通	a	Y	N	O	O
分量	n	Y	N	O	O
并	c	N	N	O	O
标记	n	N	N	O	O
，	x	N	N	O	O
对于	p	N	N	O	O
每个	r	N	N	O	O
连通	a	Y	N	O	O
分量	n	Y	N	O	O
都	d	N	N	O	O
用	p	N	N	O	O
变量	vn	N	N	O	O
维护	v	Y	N	O	O
最长	a	Y	N	O	O
链	n	N	N	O	O
。	x	N	N	O	O

然后	c	N	N	O	O
利用	n	N	N	O	O
拓扑	v	Y	N	O	O
序	n	N	N	O	O
自	r	N	N	O	O
底向上	l	N	N	O	O
BFS	eng	N	N	O	B-KNOWLEDGE
，	x	N	N	O	O
处理	v	N	N	O	O
完	v	N	N	O	O
所有	b	N	N	O	O
的	uj	N	N	O	O
树边	s	N	N	O	O
，	x	N	N	O	O
此时	c	N	N	O	O
就	d	N	N	O	O
只	d	N	N	O	O
剩下	v	N	N	O	O
一个个	m	N	N	O	O
环	v	N	N	O	O
了	ul	N	N	O	O
。	x	N	N	O	O

那么	r	N	N	O	O
接下来	l	N	N	O	O
两者	n	N	N	O	O
面临	v	N	N	O	O
的	uj	N	N	O	O
就是	d	N	N	O	O
同一个	b	N	N	O	O
问题	n	N	N	O	O
：	x	N	N	O	O
在	p	N	N	O	O
O	eng	N	N	O	O
(	x	N	N	O	O
n	x	N	N	O	O
)	x	N	N	O	O
时间	n	N	N	O	O
内	n	N	N	O	O
处理	v	N	N	O	O
一个	m	N	N	O	O
环	v	N	N	O	O
。	x	N	N	O	O

我们	r	N	N	O	O
要	v	N	N	O	O
用到	v	N	N	O	O
单调	n	Y	N	O	B-KNOWLEDGE
队列	n	Y	N	O	I-KNOWLEDGE
优化	vn	Y	N	O	O
的	uj	N	N	O	O
DP	eng	N	N	O	B-KNOWLEDGE
。	x	N	N	O	O

首先	d	N	N	O	O
把	p	N	N	O	O
环	n	N	N	O	O
拆成	v	N	N	O	O
链	n	N	N	O	O
放到	v	N	N	O	O
一个	m	N	N	O	O
数组	n	Y	N	O	O
里	f	N	N	O	O
，	x	N	N	O	O
然后	c	N	N	O	O
把	p	N	N	O	O
数组	n	Y	N	O	O
扩大	v	N	N	O	O
一倍	m	N	N	O	O
（	x	N	N	O	O
也	d	N	N	O	O
就是	d	N	N	O	O
复制	v	N	N	O	O
一遍	m	N	N	O	O
接到	v	N	N	O	O
后边	f	N	N	O	O
）	x	N	N	O	O
，	x	N	N	O	O
这样	r	N	N	O	O
就	d	N	N	O	O
相当于	v	N	N	O	O
一个	m	N	N	O	O
环	v	N	N	O	O
了	ul	N	N	O	O
。	x	N	N	O	O

然后	c	N	N	O	O
对于	p	N	N	O	O
决策	n	N	N	O	O
i	eng	N	N	O	O
和	c	N	N	O	O
j	eng	N	N	O	O
，	x	N	N	O	O
当前	t	N	N	O	O
循环	vn	N	N	O	O
到	v	N	N	O	O
的	uj	N	N	O	O
点	m	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
时	n	N	N	O	O
，	x	N	N	O	O
决策	n	N	N	O	O
i	eng	N	N	O	O
和	c	N	N	O	O
j	eng	N	N	O	O
距离	n	Y	N	O	O
当前	t	N	N	O	O
循环	vn	N	N	O	O
到	v	N	N	O	O
的	uj	N	N	O	O
点	m	N	N	O	O
的	uj	N	N	O	O
距离	n	Y	N	O	O
同时	c	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
，	x	N	N	O	O
因此	c	N	N	O	O
如果	c	N	N	O	O
某	r	N	N	O	O
时刻	n	N	N	O	O
i	eng	N	N	O	O
比	p	N	N	O	O
j	eng	N	N	O	O
优	n	N	N	O	O
，	x	N	N	O	O
那么	r	N	N	O	O
下	f	N	N	O	O
一	m	N	N	O	O
时刻	n	N	N	O	O
i	x	N	N	O	O
仍然	d	N	N	O	O
比	p	N	N	O	O
j	eng	N	N	O	O
优	n	N	N	O	O
，	x	N	N	O	O
所以	c	N	N	O	O
决策	n	N	N	O	O
单调	n	Y	N	O	O
。	x	N	N	O	O

跟	p	N	N	O	O
据	p	N	N	O	O
题目	n	Y	N	O	O
的	uj	N	N	O	O
不同	a	N	N	O	O
要留	v	N	N	O	O
，	x	N	N	O	O
Cactus	eng	N	N	O	O
这	r	N	N	O	O
题	n	N	N	O	O
当	p	N	N	O	O
队头	n	N	N	O	O
决策	n	N	N	O	O
和	c	N	N	O	O
当前	t	N	N	O	O
点	m	N	N	O	O
相距	v	N	N	O	O
超过	v	N	N	O	O
半个	m	N	N	O	O
环长	n	N	N	O	O
时	n	N	N	O	O
删掉	v	N	N	O	O
队头	n	N	N	O	O
，	x	N	N	O	O
Island	eng	N	N	O	O
这	r	N	N	O	O
题	n	N	N	O	O
相距	v	N	N	O	O
达到	v	N	N	O	O
一个	m	N	N	O	O
环长	n	N	N	O	O
时	n	N	N	O	O
删掉	v	N	N	O	O
队头	n	N	N	O	O
决策	n	N	N	O	O
。	x	N	N	O	O

具体	a	N	N	O	O
问题	n	N	N	O	O
详见	a	N	N	O	O
代码	n	N	N	O	O
，	x	N	N	O	O
代码	n	N	N	O	O
还是	c	N	N	O	O
比较	d	N	N	O	O
容易	a	N	N	O	O
看懂	v	N	N	O	O
的	uj	N	N	O	O
，	x	N	N	O	O
代码	n	N	N	O	O
长度	ns	Y	N	O	O
两道	m	N	N	O	O
题	n	N	N	O	O
都	d	N	N	O	O
排	v	N	N	O	O
第一	m	N	N	O	O
。	x	N	N	O	O
。	x	N	N	O	O

POJ3567	eng	N	Y	O	B-OJ

/	x	N	N	O	O

Bzoj1023	eng	N	Y	O	B-OJ

Cactus	eng	N	N	O	O

#	x	N	N	O	O
include	eng	N	N	O	O
<	x	N	N	O	O
iostream	eng	N	N	O	O
>	x	N	N	O	O

#	x	N	N	O	O
include	eng	N	N	O	O
<	x	N	N	O	O
cstdio	eng	N	N	O	O
>	x	N	N	O	O

using	eng	N	N	O	O

namespace	eng	N	N	O	O

std	eng	N	N	O	O
;	x	N	N	O	O

const	eng	N	N	O	O

int	eng	N	N	O	O

u	x	N	N	O	O
=	x	N	N	O	O
50010	m	N	N	O	O
,	x	N	N	O	O
w	x	N	N	O	O
=	x	N	N	O	O
200010	m	N	N	O	O
;	x	N	N	O	O

int	eng	N	N	O	O

ver	eng	N	N	O	O
[	x	N	N	O	O
w	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
w	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
dfn	eng	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
low	eng	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
fa	eng	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
*	x	N	N	O	O
2	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
*	x	N	N	O	O
2	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

int	eng	N	N	O	O

n	x	N	N	O	O
,	x	N	N	O	O
m	x	N	N	O	O
,	x	N	N	O	O
tot	eng	N	N	O	O
,	x	N	N	O	O
num	eng	N	N	O	O
,	x	N	N	O	O
ans	eng	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
j	x	N	N	O	O
,	x	N	N	O	O
k	x	N	N	O	O
,	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
;	x	N	N	O	O

void	eng	N	N	O	O

add	eng	N	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

x	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

y	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

ver	eng	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
tot	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
y	x	N	N	O	O
;	x	N	N	O	O

next	eng	N	N	O	O
[	x	N	N	O	O
tot	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

head	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
tot	eng	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

void	eng	N	N	O	O

dp	eng	Y	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

x	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

y	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

int	eng	N	N	O	O

m	x	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
,	x	N	N	O	O
p	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
m	x	N	N	O	O
=	x	N	N	O	O
0	x	N	N	O	O
;	x	N	N	O	O
y	x	N	N	O	O
!	x	N	N	O	O
=	x	N	N	O	O
x	x	N	N	O	O
;	x	N	N	O	O
y	x	N	N	O	O
=	x	N	N	O	O
fa	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
m	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
m	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
m	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
m	eng	N	N	O	O
+	x	N	N	O	O
i	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

l	x	N	N	O	O
=	x	N	N	O	O
r	x	N	N	O	O
=	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O

p	x	N	N	O	O
=	x	N	N	O	O
m	x	N	N	O	O
/	x	N	N	O	O
2	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
2	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
m	eng	N	N	O	O
+	x	N	N	O	O
p	eng	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

while	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
r	eng	N	N	O	O
&&	x	N	N	O	O
i	eng	N	N	O	O
-	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
>	x	N	N	O	O
p	x	N	N	O	O
)	x	N	N	O	O

l	eng	N	N	O	O
++	x	N	N	O	O
;	x	N	N	O	O

ans	eng	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
ans	eng	N	N	O	O
,	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
a	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
i	eng	N	N	O	O
-	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

while	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
r	eng	N	N	O	O
&&	x	N	N	O	O
a	eng	N	N	O	O
[	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
r	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
i	eng	N	N	O	O
-	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
r	x	N	N	O	O
]	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

r	x	N	N	O	O
-	x	N	N	O	O
-	x	N	N	O	O
;	x	N	N	O	O

q	x	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
r	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
m	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
min	eng	N	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
m	x	N	N	O	O
-	x	N	N	O	O
i	x	N	N	O	O
)	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

void	eng	N	N	O	O

tarjan	eng	Y	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

x	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

dfn	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
low	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
++	x	N	N	O	O
num	eng	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

i	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
fa	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
!	x	N	N	O	O
=	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
!	x	N	N	O	O
dfn	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

fa	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
x	x	N	N	O	O
;	x	N	N	O	O

tarjan	eng	Y	N	O	O
(	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

low	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
min	eng	N	N	O	O
(	x	N	N	O	O
low	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
low	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
dfn	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
<	x	N	N	O	O
low	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

ans	eng	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
ans	eng	N	N	O	O
,	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
f	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

}	x	N	N	O	O

else	eng	N	N	O	O

low	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
min	eng	N	N	O	O
(	x	N	N	O	O
low	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
dfn	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

i	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
fa	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
!	x	N	N	O	O
=	x	N	N	O	O
x	eng	N	N	O	O
&&	x	N	N	O	O
dfn	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
<	x	N	N	O	O
dfn	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

dp	eng	Y	N	O	O
(	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

int	eng	N	N	O	O

main	eng	N	N	O	O
(	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

cin	eng	N	N	O	O
>	x	N	N	O	O
>	x	N	N	O	O
n	x	N	N	O	O
>	x	N	N	O	O
>	x	N	N	O	O
m	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
m	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

scanf	eng	N	N	O	O
(	x	N	N	O	O
"	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
"	x	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
k	eng	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
x	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
j	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
j	x	N	N	O	O
<	x	N	N	O	O
k	x	N	N	O	O
;	x	N	N	O	O
j	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

scanf	eng	N	N	O	O
(	x	N	N	O	O
"	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
"	x	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
y	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

add	eng	N	N	O	O
(	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

add	eng	N	N	O	O
(	x	N	N	O	O
y	x	N	N	O	O
,	x	N	N	O	O
x	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

x	x	N	N	O	O
=	x	N	N	O	O
y	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

}	x	N	N	O	O

tarjan	eng	Y	N	O	O
(	x	N	N	O	O
1	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

cout	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
ans	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
endl	eng	N	N	O	O
;	x	N	N	O	O

return	eng	N	N	O	O

0	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

Bzoj1791	eng	N	Y	O	B-OJ

[	x	N	N	O	O
IOI2008	eng	N	N	O	O
]	x	N	N	O	O

Island	eng	N	N	O	O

#	x	N	N	O	O
include	eng	N	N	O	O
<	x	N	N	O	O
iostream	eng	N	N	O	O
>	x	N	N	O	O

#	x	N	N	O	O
include	eng	N	N	O	O
<	x	N	N	O	O
cstdio	eng	N	N	O	O
>	x	N	N	O	O

using	eng	N	N	O	O

namespace	eng	N	N	O	O

std	eng	N	N	O	O
;	x	N	N	O	O

const	eng	N	N	O	O

int	eng	N	N	O	O

u	x	N	N	O	O
=	x	N	N	O	O
1000010	m	N	N	O	O
;	x	N	N	O	O

int	eng	N	N	O	O

ver	eng	N	N	O	O
[	x	N	N	O	O
2	x	N	N	O	O
*	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
edge	eng	N	N	O	O
[	x	N	N	O	O
2	x	N	N	O	O
*	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
2	x	N	N	O	O
*	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
du	eng	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
v	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
2	x	N	N	O	O
*	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

long	eng	N	N	O	O

long	eng	N	N	O	O

f	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
d	x	N	N	O	O
[	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
2	x	N	N	O	O
*	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
b	x	N	N	O	O
[	x	N	N	O	O
2	x	N	N	O	O
*	x	N	N	O	O
u	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
ans	eng	N	N	O	O
;	x	N	N	O	O

int	eng	N	N	O	O

n	x	N	N	O	O
,	x	N	N	O	O
m	x	N	N	O	O
,	x	N	N	O	O
tot	eng	N	N	O	O
,	x	N	N	O	O
t	x	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
;	x	N	N	O	O

void	eng	N	N	O	O

add	eng	N	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

x	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

y	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

z	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

ver	eng	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
tot	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
y	x	N	N	O	O
;	x	N	N	O	O

edge	eng	N	N	O	O
[	x	N	N	O	O
tot	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
z	x	N	N	O	O
;	x	N	N	O	O

next	eng	N	N	O	O
[	x	N	N	O	O
tot	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

head	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
tot	eng	N	N	O	O
;	x	N	N	O	O

du	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
++	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

void	eng	N	N	O	O

bfs	eng	N	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

s	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

t	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

int	eng	N	N	O	O

l	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O

q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
=	x	N	N	O	O
r	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
s	x	N	N	O	O
;	x	N	N	O	O

c	x	N	N	O	O
[	x	N	N	O	O
s	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
t	x	N	N	O	O
;	x	N	N	O	O

while	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
r	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
!	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
r	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

c	x	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
t	x	N	N	O	O
;	x	N	N	O	O
}	x	N	N	O	O

l	eng	N	N	O	O
++	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

}	x	N	N	O	O

void	eng	N	N	O	O

topsort	eng	N	N	O	O
(	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

int	eng	N	N	O	O

l	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
=	x	N	N	O	O
0	x	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
n	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
du	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
)	x	N	N	O	O

q	x	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
r	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O

while	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
r	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
=	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
du	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
=	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
>	x	N	N	O	O
1	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

d	x	N	N	O	O
[	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
d	x	N	N	O	O
[	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
f	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
edge	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

f	x	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
edge	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
(	x	N	N	O	O
-	x	N	N	O	O
-	x	N	N	O	O
du	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
=	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
)	x	N	N	O	O

q	x	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
r	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
y	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

l	eng	N	N	O	O
++	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

}	x	N	N	O	O

void	eng	N	N	O	O

dp	eng	Y	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

t	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

x	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

int	eng	N	N	O	O

m	x	N	N	O	O
=	x	N	N	O	O
0	x	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
=	x	N	N	O	O
0	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
=	x	N	N	O	O
x	x	N	N	O	O
;	x	N	N	O	O

do	eng	N	N	O	O
{	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
m	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

du	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
du	eng	N	N	O	O
[	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
>	x	N	N	O	O
1	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O
y	x	N	N	O	O
=	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

b	x	N	N	O	O
[	x	N	N	O	O
m	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
b	x	N	N	O	O
[	x	N	N	O	O
m	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
edge	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

break	eng	N	N	O	O
;	x	N	N	O	O
}	x	N	N	O	O

}	x	N	N	O	O
while	eng	N	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
m	x	N	N	O	O
=	x	N	N	O	O
=	x	N	N	O	O
2	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
=	x	N	N	O	O
x	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O
l	x	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
edge	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O
}	x	N	N	O	O

d	x	N	N	O	O
[	x	N	N	O	O
t	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
d	x	N	N	O	O
[	x	N	N	O	O
t	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
f	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
f	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
l	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

return	eng	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
head	eng	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
next	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
ver	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
=	x	N	N	O	O
x	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O
b	x	N	N	O	O
[	x	N	N	O	O
m	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
b	x	N	N	O	O
[	x	N	N	O	O
m	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
edge	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

break	eng	N	N	O	O
;	x	N	N	O	O
}	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
m	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
m	eng	N	N	O	O
+	x	N	N	O	O
i	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

b	x	N	N	O	O
[	x	N	N	O	O
m	eng	N	N	O	O
+	x	N	N	O	O
i	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
b	x	N	N	O	O
[	x	N	N	O	O
m	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
b	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O
}	x	N	N	O	O

q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
=	x	N	N	O	O
r	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
2	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
2	x	N	N	O	O
*	x	N	N	O	O
m	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

while	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
r	eng	N	N	O	O
&&	x	N	N	O	O
i	eng	N	N	O	O
-	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
>	x	N	N	O	O
=	x	N	N	O	O
m	x	N	N	O	O
)	x	N	N	O	O

l	eng	N	N	O	O
++	x	N	N	O	O
;	x	N	N	O	O

d	x	N	N	O	O
[	x	N	N	O	O
t	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
max	eng	N	N	O	O
(	x	N	N	O	O
d	x	N	N	O	O
[	x	N	N	O	O
t	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
a	eng	N	N	O	O
[	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
b	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
-	x	N	N	O	O
b	x	N	N	O	O
[	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

while	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
r	eng	N	N	O	O
&&	x	N	N	O	O
a	eng	N	N	O	O
[	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
r	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
+	x	N	N	O	O
b	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
-	x	N	N	O	O
b	x	N	N	O	O
[	x	N	N	O	O
q	x	N	N	O	O
[	x	N	N	O	O
r	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
a	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

r	x	N	N	O	O
-	x	N	N	O	O
-	x	N	N	O	O
;	x	N	N	O	O

q	x	N	N	O	O
[	x	N	N	O	O
++	x	N	N	O	O
r	eng	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
i	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

}	x	N	N	O	O

int	eng	N	N	O	O

main	eng	N	N	O	O
(	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

cin	eng	N	N	O	O
>	x	N	N	O	O
>	x	N	N	O	O
n	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
n	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

scanf	eng	N	N	O	O
(	x	N	N	O	O
"	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
"	x	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
x	eng	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
y	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

add	eng	N	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

add	eng	N	N	O	O
(	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
n	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
!	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

bfs	eng	N	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
++	x	N	N	O	O
t	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

topsort	eng	N	N	O	O
(	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
n	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
du	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
>	x	N	N	O	O
1	m	N	N	O	O
&&	x	N	N	O	O
!	x	N	N	O	O
v	x	N	N	O	O
[	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O

{	x	N	N	O	O

v	x	N	N	O	O
[	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O

dp	eng	Y	N	O	O
(	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

ans	eng	N	N	O	O
+	x	N	N	O	O
=	x	N	N	O	O
d	x	N	N	O	O
[	x	N	N	O	O
c	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

cout	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
ans	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
endl	eng	N	N	O	O
;	x	N	N	O	O

return	eng	N	N	O	O

0	x	N	N	O	O
;	x	N	N	O	O

}	x	N	N	O	O

