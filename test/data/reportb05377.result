2012	m	N	N	O	O
金华	nz	N	N	O	O
邀请赛	n	N	N	O	O
D	eng	N	N	O	O
题	n	N	N	O	O
(	x	N	N	O	O
POJ4047	eng	N	Y	O	B-OJ

Garden	eng	N	N	O	O
)	x	N	N	O	O
解题	n	N	N	O	O
报告	n	N	N	O	O

-	x	N	N	O	O

NKHe	eng	N	N	O	O
!	x	N	N	O	O
!	x	N	N	O	O
oWor	eng	N	N	O	O
!	x	N	N	O	O
d	x	N	N	O	O

-	x	N	N	O	O

博客园	nr	N	N	O	O

金华	nz	N	N	O	O
邀请赛	n	N	N	O	O
D	eng	N	N	O	O
题	n	N	N	O	O
，	x	N	N	O	O
现场	n	N	N	O	O
lazy	eng	Y	N	O	O
标记	n	N	N	O	O
推错	v	N	N	O	O
了	ul	N	N	O	O
，	x	N	N	O	O
颇为	v	N	N	O	O
不爽	a	N	N	O	O
，	x	N	N	O	O
重	a	N	N	O	O
做	v	N	N	O	O
一下	m	N	N	O	O
。	x	N	N	O	O

给出	v	N	N	O	O
一个	m	N	N	O	O
N	x	N	N	O	O
个数	n	Y	N	O	O
的	uj	N	N	O	O
序列	n	Y	N	O	O
以及	c	N	N	O	O
一个	m	N	N	O	O
k	x	N	N	O	O
（	x	N	N	O	O
0	x	N	N	O	O
<	x	N	N	O	O
k	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
n	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
200000	m	N	N	O	O
)	x	N	N	O	O
，	x	N	N	O	O
m	eng	N	N	O	O
个	m	N	N	O	O
操作	v	Y	N	O	O
p	x	N	N	O	O
,	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
，	x	N	N	O	O
其中	r	N	N	O	O

p	x	N	N	O	O
=	x	N	N	O	O
0	x	N	N	O	O
：	x	N	N	O	O
将	d	N	N	O	O
x	eng	N	N	O	O
位置	v	N	N	O	O
的	uj	N	N	O	O
数	n	N	N	O	O
替换	v	Y	N	O	O
为	p	N	N	O	O
y	eng	N	N	O	O

p	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
：	x	N	N	O	O
将	d	N	N	O	O
x	eng	N	N	O	O

y	x	N	N	O	O
位置	v	N	N	O	O
的	uj	N	N	O	O
数	n	N	N	O	O
互换	v	N	N	O	O

p	x	N	N	O	O
=	x	N	N	O	O
2	x	N	N	O	O
:	x	N	N	O	O

查询	v	N	N	O	O
x	x	N	N	O	O
-	x	N	N	O	O
y	x	N	N	O	O
位置	v	N	N	O	O
区间	n	Y	N	O	O
连续	a	Y	N	O	O
k	x	N	N	O	O
个数	n	Y	N	O	O
的	uj	N	N	O	O
和	c	N	N	O	O
的	uj	N	N	O	O
最大值	l	N	N	O	O

很快	d	N	N	O	O
可以	c	N	N	O	O
想到	v	N	N	O	O
用	p	N	N	O	O
O	eng	N	N	O	O
(	x	N	N	O	O
n	x	N	N	O	O
)	x	N	N	O	O
的	uj	N	N	O	O
复杂度	n	N	N	O	O
预处理	vn	N	N	O	O
，	x	N	N	O	O
将	d	N	N	O	O
从	p	N	N	O	O
i	eng	N	N	O	O
位置	v	N	N	O	O
起始	v	N	N	O	O
连续	a	Y	N	O	O
k	x	N	N	O	O
个数	n	Y	N	O	O
的	uj	N	N	O	O
和求	n	N	N	O	O
出来	v	N	N	O	O
，	x	N	N	O	O
那么	r	N	N	O	O
对于	p	N	N	O	O
查询	v	N	N	O	O
操作	v	Y	N	O	O
，	x	N	N	O	O
就	d	N	N	O	O
变为	v	N	N	O	O
查询	v	N	N	O	O
和	c	N	N	O	O
数组	n	Y	N	O	O
中	ns	N	N	O	O
x	eng	N	N	O	O
~	x	N	N	O	O
y	x	N	N	O	O
-	x	N	N	O	O
k	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
这个	r	N	N	O	O
区间	n	Y	N	O	O
里	f	N	N	O	O
的	uj	N	N	O	O
最大值	l	N	N	O	O
。	x	N	N	O	O

再	d	N	N	O	O
看	v	N	N	O	O
对于	p	N	N	O	O
前	f	N	N	O	O
两种	m	N	N	O	O
操作	v	Y	N	O	O
，	x	N	N	O	O
第二种	m	N	N	O	O
可以	c	N	N	O	O
等效于	v	N	N	O	O
两次	m	N	N	O	O
第一种	m	N	N	O	O
操作	v	Y	N	O	O
。	x	N	N	O	O

对于	p	N	N	O	O
第一种	m	N	N	O	O
操作	v	Y	N	O	O
，	x	N	N	O	O
将	d	N	N	O	O
x	eng	N	N	O	O
位置	v	N	N	O	O
由	c	N	N	O	O
y0	eng	N	N	O	O
替换	v	Y	N	O	O
为	p	N	N	O	O
y	eng	N	N	O	O
，	x	N	N	O	O
变化	vn	N	N	O	O
量	n	N	N	O	O
det	eng	N	N	O	O
=	x	N	N	O	O
y	x	N	N	O	O
-	x	N	N	O	O
y0	eng	N	N	O	O
，	x	N	N	O	O
这个	r	N	N	O	O
变化	vn	N	N	O	O
量	n	N	N	O	O
会	v	N	N	O	O
对	p	N	N	O	O
和	c	N	N	O	O
数组	n	Y	N	O	O
产生	n	N	N	O	O
怎样	r	N	N	O	O
得	ud	N	N	O	O
影响	vn	N	N	O	O
呢	y	N	N	O	O
？	x	N	N	O	O
很	zg	N	N	O	O
明显	a	N	N	O	O
会	v	N	N	O	O
导致	v	N	N	O	O
和	c	N	N	O	O
数组	n	Y	N	O	O
的	uj	N	N	O	O
x	eng	N	N	O	O
-	x	N	N	O	O
k	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
~	x	N	N	O	O
x	eng	N	N	O	O
这	r	N	N	O	O
也	d	N	N	O	O
一段	m	N	N	O	O
产生	n	N	N	O	O
影响	vn	N	N	O	O
，	x	N	N	O	O
效果	n	N	N	O	O
为	p	N	N	O	O
值	n	N	N	O	O
都	d	N	N	O	O
变化	vn	N	N	O	O
det	eng	N	N	O	O
。	x	N	N	O	O

至此	d	N	N	O	O
，	x	N	N	O	O
整个	b	N	N	O	O
问题	n	N	N	O	O
就	d	N	N	O	O
变成	v	N	N	O	O
了	ul	N	N	O	O
成段	n	N	N	O	O
修改	v	N	N	O	O
成段	n	N	N	O	O
查询	v	N	N	O	O
问题	n	N	N	O	O
。	x	N	N	O	O

用	p	N	N	O	O
线段	n	Y	N	O	O
数	n	N	N	O	O
可以	c	N	N	O	O
解决	v	N	N	O	O
。	x	N	N	O	O

对于	p	N	N	O	O
成段	n	N	N	O	O
修改	v	N	N	O	O
，	x	N	N	O	O
需要	v	N	N	O	O
用到	v	N	N	O	O
lazy	eng	Y	N	O	O
思想	n	Y	N	O	O
，	x	N	N	O	O
即	v	N	N	O	O
能	v	N	N	O	O
不	d	N	N	O	O
多	m	N	N	O	O
改	v	N	N	O	O
就	d	N	N	O	O
不多	d	N	N	O	O
改	v	N	N	O	O
，	x	N	N	O	O
等	u	N	N	O	O
需要	v	N	N	O	O
时	ng	N	N	O	O
再	d	N	N	O	O
改	v	N	N	O	O
。	x	N	N	O	O

去年	t	N	N	O	O
暑假	t	N	N	O	O
时	ng	N	N	O	O
是	v	N	N	O	O
做	v	N	N	O	O
过	ug	N	N	O	O
不少	d	N	N	O	O
各种类型	l	N	N	O	O
的	uj	N	N	O	O
线段	n	Y	N	O	B-KNOWLEDGE
树	v	N	N	O	I-KNOWLEDGE
的	uj	N	N	O	O
，	x	N	N	O	O
但是	c	N	N	O	O
区域	n	N	N	O	O
赛后	t	N	N	O	O
就	d	N	N	O	O
再	d	N	N	O	O
没写	v	N	N	O	O
过	ug	N	N	O	O
，	x	N	N	O	O
于是	c	N	N	O	O
现场	n	N	N	O	O
时	ng	N	N	O	O
就	d	N	N	O	O
死	v	N	N	O	O
在	p	N	N	O	O
了	ul	N	N	O	O
这个	r	N	N	O	O
问题	n	N	N	O	O
上	f	N	N	O	O
…	x	N	N	O	O
…	x	N	N	O	O
这	r	N	N	O	O
是	v	N	N	O	O
客观因素	n	N	N	O	O
，	x	N	N	O	O
主观	n	N	N	O	O
上	f	N	N	O	O
也	d	N	N	O	O
有	v	N	N	O	O
理解	v	N	N	O	O
的	uj	N	N	O	O
深度	ns	Y	N	O	O
不够	v	N	N	O	O
的	uj	N	N	O	O
问题	n	N	N	O	O
…	x	N	N	O	O
…	x	N	N	O	O
其实	d	N	N	O	O
此	r	N	N	O	O
题	n	N	N	O	O
唯一	b	N	N	O	O
算是	v	N	N	O	O
难点	d	N	N	O	O
的	uj	N	N	O	O
地方	n	N	N	O	O
在于	v	N	N	O	O
构造	v	Y	N	O	O
成	n	N	N	O	O
适合	v	N	N	O	O
线段	n	Y	N	O	B-KNOWLEDGE
树	v	N	N	O	I-KNOWLEDGE
的	uj	N	N	O	O
形式	n	N	N	O	O
，	x	N	N	O	O
难点	d	N	N	O	O
搞	v	N	N	O	O
过	ug	N	N	O	O
了	ul	N	N	O	O
却	d	N	N	O	O
卡在	v	N	N	O	O
了	ul	N	N	O	O
实现	v	N	N	O	O
上	f	N	N	O	O
…	x	N	N	O	O
…	x	N	N	O	O

需要	v	N	N	O	O
注意	v	N	N	O	O
的	uj	N	N	O	O
一点	m	N	N	O	O
是	v	N	N	O	O
，	x	N	N	O	O
当	t	N	N	O	O
需要	v	N	N	O	O
用到	v	N	N	O	O
真实	d	N	N	O	O
值	n	N	N	O	O
的	uj	N	N	O	O
时候	n	N	N	O	O
，	x	N	N	O	O
必须	d	N	N	O	O
先	d	N	N	O	O
进行	v	N	N	O	O
pushdown	eng	N	N	O	O
操作	v	Y	N	O	O
，	x	N	N	O	O
无论	c	N	N	O	O
在	p	N	N	O	O
任何	r	N	N	O	O
地方	n	N	N	O	O
都	d	N	N	O	O
是	v	N	N	O	O
这样	r	N	N	O	O
！	x	N	N	O	O
今天	t	N	N	O	O
第一次	m	N	N	O	O
提交	v	N	N	O	O
就	d	N	N	O	O
因为	c	N	N	O	O
在	p	N	N	O	O
update	eng	N	N	O	O
中求	n	N	N	O	O
最大值	l	N	N	O	O
时	n	N	N	O	O
没有	v	N	N	O	O
对	p	N	N	O	O
左右	m	N	N	O	O
孩子	n	N	N	O	O
进行	v	N	N	O	O
pushdown	eng	N	N	O	O
而	c	N	N	O	O
WA	eng	N	N	O	O
了	ul	N	N	O	O
一次	m	N	N	O	O
…	x	N	N	O	O
…	x	N	N	O	O

1	x	N	N	O	O

/	x	N	N	O	O
/	x	N	N	O	O
10184789	m	N	N	O	O

NKHelloWorld	eng	N	N	O	O

4047	m	N	N	O	O

Accepted	eng	N	N	O	O

5980	m	N	N	O	O
K	eng	N	N	O	O

329	m	N	N	O	O
MS	eng	N	N	O	O

G	eng	N	N	O	O
++	x	N	N	O	O

2373	m	N	N	O	O
B	eng	N	N	O	O

2012	m	N	N	O	O
-	x	N	N	O	O
05	m	N	N	O	O
-	x	N	N	O	O
11	m	N	N	O	O

20	m	N	N	O	O
:	x	N	N	O	O
59	m	N	N	O	O
:	x	N	N	O	O
20	m	N	N	O	O

2	x	N	N	O	O

#	x	N	N	O	O
include	eng	N	N	O	O

<	x	N	N	O	O
cstdio	eng	N	N	O	O
>	x	N	N	O	O

3	x	N	N	O	O

#	x	N	N	O	O
include	eng	N	N	O	O

<	x	N	N	O	O
iostream	eng	N	N	O	O
>	x	N	N	O	O

4	x	N	N	O	O

using	eng	N	N	O	O

namespace	eng	N	N	O	O

std	eng	N	N	O	O
;	x	N	N	O	O

5	x	N	N	O	O

#	x	N	N	O	O
define	eng	N	N	O	O

MAXN	eng	N	N	O	O

210000	m	N	N	O	O

6	x	N	N	O	O

7	x	N	N	O	O

int	eng	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
MAXN	eng	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
sum	eng	N	N	O	O
[	x	N	N	O	O
MAXN	eng	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

8	x	N	N	O	O

int	eng	N	N	O	O

n	x	N	N	O	O
,	x	N	N	O	O
m	x	N	N	O	O
,	x	N	N	O	O
k	x	N	N	O	O
;	x	N	N	O	O

9	x	N	N	O	O

10	m	N	N	O	O

struct	eng	N	N	O	O

SEGTREE	eng	N	N	O	O

11	m	N	N	O	O

{	x	N	N	O	O

12	m	N	N	O	O

int	eng	N	N	O	O

l	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
,	x	N	N	O	O
maxval	eng	N	N	O	O
,	x	N	N	O	O
det	eng	N	N	O	O
;	x	N	N	O	O

13	m	N	N	O	O

}	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
MAXN	eng	N	N	O	O
*	x	N	N	O	O
4	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

14	m	N	N	O	O

15	m	N	N	O	O

void	eng	N	N	O	O

buildsegtree	eng	N	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

root	eng	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

l	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

r	x	N	N	O	O
)	x	N	N	O	O

16	m	N	N	O	O

{	x	N	N	O	O

17	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
l	eng	N	N	O	O

=	x	N	N	O	O

l	x	N	N	O	O
;	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
r	eng	N	N	O	O

=	x	N	N	O	O

r	x	N	N	O	O
;	x	N	N	O	O

18	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O

=	x	N	N	O	O

0	x	N	N	O	O
;	x	N	N	O	O

19	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O

=	x	N	N	O	O
=	x	N	N	O	O

r	x	N	N	O	O
)	x	N	N	O	O

20	m	N	N	O	O

{	x	N	N	O	O

21	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O

=	x	N	N	O	O

sum	eng	N	N	O	O
[	x	N	N	O	O
l	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

22	m	N	N	O	O

return	eng	N	N	O	O

;	x	N	N	O	O

23	m	N	N	O	O

}	x	N	N	O	O

24	m	N	N	O	O

int	eng	N	N	O	O

mid	eng	N	N	O	O

=	x	N	N	O	O

(	x	N	N	O	O
l	eng	N	N	O	O
+	x	N	N	O	O
r	eng	N	N	O	O
)	x	N	N	O	O
>	x	N	N	O	O
>	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O

25	m	N	N	O	O

buildsegtree	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
mid	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

26	m	N	N	O	O

buildsegtree	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
mid	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

27	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O

=	x	N	N	O	O

max	eng	N	N	O	O
(	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O
,	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

28	m	N	N	O	O

}	x	N	N	O	O

29	m	N	N	O	O

30	m	N	N	O	O

void	eng	N	N	O	O

pushdown	eng	N	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

root	eng	N	N	O	O
)	x	N	N	O	O

31	m	N	N	O	O

{	x	N	N	O	O

32	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O

=	x	N	N	O	O
=	x	N	N	O	O

0	x	N	N	O	O
)	x	N	N	O	O

return	eng	N	N	O	O

;	x	N	N	O	O

33	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O

+	x	N	N	O	O
=	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O
;	x	N	N	O	O

34	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
l	eng	N	N	O	O

!	x	N	N	O	O
=	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
r	eng	N	N	O	O
)	x	N	N	O	O

35	m	N	N	O	O

{	x	N	N	O	O

36	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O

+	x	N	N	O	O
=	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O
;	x	N	N	O	O

37	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O

+	x	N	N	O	O
=	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O
;	x	N	N	O	O

38	m	N	N	O	O

}	x	N	N	O	O

39	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O

=	x	N	N	O	O

0	x	N	N	O	O
;	x	N	N	O	O

40	m	N	N	O	O

}	x	N	N	O	O

41	m	N	N	O	O

42	m	N	N	O	O

void	eng	N	N	O	O

update	eng	N	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

root	eng	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

l	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

r	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

det	eng	N	N	O	O
)	x	N	N	O	O

43	m	N	N	O	O

{	x	N	N	O	O

44	m	N	N	O	O

pushdown	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

45	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
l	eng	N	N	O	O

=	x	N	N	O	O
=	x	N	N	O	O

l	x	N	N	O	O

&&	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
r	eng	N	N	O	O

=	x	N	N	O	O
=	x	N	N	O	O

r	x	N	N	O	O
)	x	N	N	O	O

46	m	N	N	O	O

{	x	N	N	O	O

47	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
det	eng	N	N	O	O

+	x	N	N	O	O
=	x	N	N	O	O

det	eng	N	N	O	O
;	x	N	N	O	O

48	m	N	N	O	O

return	eng	N	N	O	O

;	x	N	N	O	O

49	m	N	N	O	O

}	x	N	N	O	O

50	m	N	N	O	O

int	eng	N	N	O	O

mid	eng	N	N	O	O

=	x	N	N	O	O

(	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
l	eng	N	N	O	O

+	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
r	eng	N	N	O	O
)	x	N	N	O	O
>	x	N	N	O	O
>	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O

51	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
r	x	N	N	O	O

<	x	N	N	O	O
=	x	N	N	O	O

mid	eng	N	N	O	O
)	x	N	N	O	O

52	m	N	N	O	O

update	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
,	x	N	N	O	O
det	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

53	m	N	N	O	O

else	eng	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O

>	x	N	N	O	O
mid	eng	N	N	O	O
)	x	N	N	O	O

54	m	N	N	O	O

update	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
,	x	N	N	O	O
det	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

55	m	N	N	O	O

else	eng	N	N	O	O

56	m	N	N	O	O

{	x	N	N	O	O

57	m	N	N	O	O

update	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
mid	eng	N	N	O	O
,	x	N	N	O	O
det	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

58	m	N	N	O	O

update	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
mid	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
,	x	N	N	O	O
det	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

59	m	N	N	O	O

}	x	N	N	O	O

60	m	N	N	O	O

pushdown	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

61	m	N	N	O	O

pushdown	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

62	m	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O

=	x	N	N	O	O

max	eng	N	N	O	O
(	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O
,	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

63	m	N	N	O	O

}	x	N	N	O	O

64	m	N	N	O	O

65	m	N	N	O	O

int	eng	N	N	O	O

query	eng	N	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

root	eng	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

l	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

r	x	N	N	O	O
)	x	N	N	O	O

66	m	N	N	O	O

{	x	N	N	O	O

67	m	N	N	O	O

pushdown	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

68	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
l	eng	N	N	O	O

=	x	N	N	O	O
=	x	N	N	O	O

l	x	N	N	O	O

&&	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
r	eng	N	N	O	O

=	x	N	N	O	O
=	x	N	N	O	O

r	x	N	N	O	O
)	x	N	N	O	O

69	m	N	N	O	O

{	x	N	N	O	O

70	m	N	N	O	O

return	eng	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
maxval	eng	N	N	O	O
;	x	N	N	O	O

71	m	N	N	O	O

}	x	N	N	O	O

72	m	N	N	O	O

int	eng	N	N	O	O

mid	eng	N	N	O	O

=	x	N	N	O	O

(	x	N	N	O	O
tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
l	eng	N	N	O	O

+	x	N	N	O	O

tree	eng	N	N	O	O
[	x	N	N	O	O
root	eng	N	N	O	O
]	x	N	N	O	O
.	m	N	N	O	O
r	eng	N	N	O	O
)	x	N	N	O	O
>	x	N	N	O	O
>	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O

73	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
r	x	N	N	O	O

<	x	N	N	O	O
=	x	N	N	O	O

mid	eng	N	N	O	O
)	x	N	N	O	O

74	m	N	N	O	O

return	eng	N	N	O	O

query	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

75	m	N	N	O	O

else	eng	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
l	x	N	N	O	O

>	x	N	N	O	O
mid	eng	N	N	O	O
)	x	N	N	O	O

76	m	N	N	O	O

return	eng	N	N	O	O

query	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

77	m	N	N	O	O

else	eng	N	N	O	O

78	m	N	N	O	O

return	eng	N	N	O	O

max	eng	N	N	O	O
(	x	N	N	O	O
query	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
l	x	N	N	O	O
,	x	N	N	O	O
mid	eng	N	N	O	O
)	x	N	N	O	O
,	x	N	N	O	O
query	eng	N	N	O	O
(	x	N	N	O	O
root	eng	N	N	O	O
<	x	N	N	O	O
<	x	N	N	O	O
1	x	N	N	O	O
|	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
mid	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
,	x	N	N	O	O
r	x	N	N	O	O
)	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

79	m	N	N	O	O

}	x	N	N	O	O

80	m	N	N	O	O

81	m	N	N	O	O

void	eng	N	N	O	O

edit	eng	N	N	O	O
(	x	N	N	O	O
int	eng	N	N	O	O

x	x	N	N	O	O
,	x	N	N	O	O
int	eng	N	N	O	O

y	x	N	N	O	O
)	x	N	N	O	O

82	m	N	N	O	O

{	x	N	N	O	O

83	m	N	N	O	O

int	eng	N	N	O	O

det	eng	N	N	O	O

=	x	N	N	O	O

y	x	N	N	O	O

-	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

84	m	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O

=	x	N	N	O	O

y	x	N	N	O	O
;	x	N	N	O	O

85	m	N	N	O	O

int	eng	N	N	O	O

ll	eng	Y	N	O	O

=	x	N	N	O	O

x	x	N	N	O	O
-	x	N	N	O	O
k	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
;	x	N	N	O	O

86	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
ll	eng	Y	N	O	O

<	x	N	N	O	O
1	x	N	N	O	O
)	x	N	N	O	O

ll	eng	Y	N	O	O

=	x	N	N	O	O

1	x	N	N	O	O
;	x	N	N	O	O

87	m	N	N	O	O

int	eng	N	N	O	O

rr	eng	N	N	O	O

=	x	N	N	O	O

x	x	N	N	O	O
;	x	N	N	O	O

88	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
x	x	N	N	O	O

>	x	N	N	O	O

n	x	N	N	O	O

-	x	N	N	O	O

k	x	N	N	O	O

+	x	N	N	O	O
1	m	N	N	O	O
)	x	N	N	O	O

rr	eng	N	N	O	O

=	x	N	N	O	O

n	x	N	N	O	O
-	x	N	N	O	O
k	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
;	x	N	N	O	O

89	m	N	N	O	O

update	eng	N	N	O	O
(	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
ll	eng	Y	N	O	O
,	x	N	N	O	O
rr	eng	N	N	O	O
,	x	N	N	O	O
det	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

90	m	N	N	O	O

}	x	N	N	O	O

91	m	N	N	O	O

92	m	N	N	O	O

int	eng	N	N	O	O

main	eng	N	N	O	O
(	x	N	N	O	O
)	x	N	N	O	O

93	m	N	N	O	O

{	x	N	N	O	O

94	m	N	N	O	O

int	eng	N	N	O	O

totcase	eng	N	N	O	O
,	x	N	N	O	O
i	x	N	N	O	O
,	x	N	N	O	O
j	x	N	N	O	O
;	x	N	N	O	O

95	m	N	N	O	O

scanf	eng	N	N	O	O
(	x	N	N	O	O
"	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
"	x	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
totcase	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

96	m	N	N	O	O

while	eng	N	N	O	O
(	x	N	N	O	O
totcase	eng	N	N	O	O
-	x	N	N	O	O
-	x	N	N	O	O
)	x	N	N	O	O

97	m	N	N	O	O

{	x	N	N	O	O

98	m	N	N	O	O

scanf	eng	N	N	O	O
(	x	N	N	O	O
"	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
"	x	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
n	eng	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
m	eng	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
k	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

99	m	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
n	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

100	m	N	N	O	O

{	x	N	N	O	O

101	m	N	N	O	O

scanf	eng	N	N	O	O
(	x	N	N	O	O
"	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
"	x	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
a	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

102	m	N	N	O	O

}	x	N	N	O	O

103	m	N	N	O	O

sum	eng	N	N	O	O
[	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O

=	x	N	N	O	O

0	x	N	N	O	O
;	x	N	N	O	O

104	m	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
k	x	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

sum	eng	N	N	O	O
[	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O

+	x	N	N	O	O
=	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

105	m	N	N	O	O

for	eng	Y	N	O	O
(	x	N	N	O	O
i	x	N	N	O	O
=	x	N	N	O	O
2	x	N	N	O	O
;	x	N	N	O	O
i	x	N	N	O	O
<	x	N	N	O	O
=	x	N	N	O	O
n	x	N	N	O	O
-	x	N	N	O	O
k	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
;	x	N	N	O	O
i	eng	N	N	O	O
++	x	N	N	O	O
)	x	N	N	O	O

sum	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
]	x	N	N	O	O

=	x	N	N	O	O

sum	eng	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
-	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O

-	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
i	x	N	N	O	O
-	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O

+	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
i	eng	N	N	O	O
+	x	N	N	O	O
k	eng	N	N	O	O
-	x	N	N	O	O
1	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

106	m	N	N	O	O

buildsegtree	eng	N	N	O	O
(	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
n	x	N	N	O	O
-	x	N	N	O	O
k	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

107	m	N	N	O	O

int	eng	N	N	O	O

p	x	N	N	O	O
,	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
;	x	N	N	O	O

108	m	N	N	O	O

while	eng	N	N	O	O
(	x	N	N	O	O
m	x	N	N	O	O
-	x	N	N	O	O
-	x	N	N	O	O
)	x	N	N	O	O

109	m	N	N	O	O

{	x	N	N	O	O

110	m	N	N	O	O

scanf	eng	N	N	O	O
(	x	N	N	O	O
"	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
"	x	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
p	eng	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
x	eng	N	N	O	O
,	x	N	N	O	O
&	x	N	N	O	O
y	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

111	m	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
p	x	N	N	O	O
=	x	N	N	O	O
=	x	N	N	O	O
0	x	N	N	O	O
)	x	N	N	O	O

112	m	N	N	O	O

{	x	N	N	O	O

113	m	N	N	O	O

edit	eng	N	N	O	O
(	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

114	m	N	N	O	O

}	x	N	N	O	O

115	m	N	N	O	O

else	eng	N	N	O	O

if	eng	N	N	O	O
(	x	N	N	O	O
p	x	N	N	O	O

=	x	N	N	O	O
=	x	N	N	O	O
1	x	N	N	O	O

)	x	N	N	O	O

116	m	N	N	O	O

{	x	N	N	O	O

117	m	N	N	O	O

int	eng	N	N	O	O

xx	eng	N	N	O	O

=	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
x	x	N	N	O	O
]	x	N	N	O	O
,	x	N	N	O	O
yy	eng	N	N	O	O

=	x	N	N	O	O

a	x	N	N	O	O
[	x	N	N	O	O
y	x	N	N	O	O
]	x	N	N	O	O
;	x	N	N	O	O

118	m	N	N	O	O

edit	eng	N	N	O	O
(	x	N	N	O	O
y	x	N	N	O	O
,	x	N	N	O	O
xx	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

119	m	N	N	O	O

edit	eng	N	N	O	O
(	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
yy	eng	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

120	m	N	N	O	O

}	x	N	N	O	O

121	m	N	N	O	O

else	eng	N	N	O	O

122	m	N	N	O	O

{	x	N	N	O	O

123	m	N	N	O	O

printf	eng	N	N	O	O
(	x	N	N	O	O
"	x	N	N	O	O
%	x	N	N	O	O
d	x	N	N	O	O
\	x	N	N	O	O
n	x	N	N	O	O
"	x	N	N	O	O
,	x	N	N	O	O
query	eng	N	N	O	O
(	x	N	N	O	O
1	x	N	N	O	O
,	x	N	N	O	O
x	x	N	N	O	O
,	x	N	N	O	O
y	x	N	N	O	O
-	x	N	N	O	O
k	eng	N	N	O	O
+	x	N	N	O	O
1	m	N	N	O	O
)	x	N	N	O	O
)	x	N	N	O	O
;	x	N	N	O	O

124	m	N	N	O	O

}	x	N	N	O	O

125	m	N	N	O	O

}	x	N	N	O	O

126	m	N	N	O	O

}	x	N	N	O	O

127	m	N	N	O	O

return	eng	N	N	O	O

0	x	N	N	O	O
;	x	N	N	O	O

128	m	N	N	O	O

}	x	N	N	O	O

