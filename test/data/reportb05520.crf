Poj3567	eng	N	Y	B-OJ
/	x	N	N	O
Bzoj1023	eng	N	Y	B-OJ
 	x	N	N	O
Cactus	eng	N	N	O
 	x	N	N	O
仙人掌	n	Y	N	O
图	n	N	N	O
的	uj	N	N	O
直径	n	Y	N	O
 	x	N	N	O
|	x	N	N	O
 	x	N	N	O
[	x	N	N	O
IOI2008	eng	N	N	O
]	x	N	N	O
 	x	N	N	O
Island	eng	N	N	O
 	x	N	N	O
-	x	N	N	O
-	x	N	N	O
-	x	N	N	O
树上	s	N	N	O
DP	eng	N	N	B-KNOWLEDGE
+	x	N	N	O
环上	n	Y	N	O
单调	n	Y	N	B-KNOWLEDGE
队列	n	Y	N	I-KNOWLEDGE
_	x	N	N	O
Poetize	eng	N	N	O
 	x	N	N	O
Space	eng	N	N	O
_	x	N	N	O
百度	n	N	N	O
空间	n	N	N	O

	x	N	N	O

	x	N	N	O
这	r	N	N	O
两个	m	N	N	O
题	n	N	N	O
主体	n	N	N	O
思路	n	N	N	O
差不多	l	N	N	O
，	x	N	N	O
都	d	N	N	O
是	v	N	N	O
在	p	N	N	O
树上	s	N	N	O
树状	n	Y	N	O
DP	eng	N	N	B-KNOWLEDGE
、	x	N	N	O
环上	n	Y	N	O
单调	n	Y	N	B-KNOWLEDGE
队列	n	Y	N	I-KNOWLEDGE
优化	vn	Y	N	O
的	uj	N	N	O
DP	eng	N	N	B-KNOWLEDGE
。	x	N	N	O

只不过	c	N	N	O
前者	n	N	N	O
的	uj	N	N	O
图	n	N	N	O
是	v	N	N	O
一棵	m	N	N	O
仙人掌	n	Y	N	O
，	x	N	N	O
后者	n	N	N	O
的	uj	N	N	O
图	n	N	N	O
是	v	N	N	O
一棵	m	N	N	O
外	f	N	N	O
/	x	N	N	O
内向	n	N	N	O
树	v	N	N	O
。	x	N	N	O


	x	N	N	O
前者	n	N	N	O
题目	n	Y	N	O
描述	v	N	N	O
很	zg	N	N	O
直接	ad	N	N	O
：	x	N	N	O
求	v	N	N	O
仙人掌	n	Y	N	O
直径	n	Y	N	O
；	x	N	N	O
后者	n	N	N	O
仔细分析	n	N	N	O
可以	c	N	N	O
发现	v	N	N	O
，	x	N	N	O
答案	n	N	N	O
就是	d	N	N	O
各个	r	N	N	O
连通	a	Y	N	O
分量	n	Y	N	O
内	n	N	N	O
最长	a	Y	N	O
链	ng	N	N	O
之	u	N	N	O
和	c	N	N	O
。	x	N	N	O


	x	N	N	O
设	n	N	N	O
F	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
表示	v	Y	N	O
点	m	N	N	O
i	eng	N	N	O
为	p	N	N	O
根	q	N	N	O
的	uj	N	N	O
子树	n	N	N	O
中	f	N	N	O
最长	a	Y	N	O
链	ng	N	N	O
有	v	N	N	O
多长	n	N	N	O
。	x	N	N	O


	x	N	N	O
对于	p	N	N	O
这	r	N	N	O
两个	m	N	N	O
题	n	N	N	O
，	x	N	N	O
图	n	N	N	O
中	f	N	N	O
的	uj	N	N	O
边	n	N	N	O
实际上	d	N	N	O
只有	c	N	N	O
两种	m	N	N	O
：	x	N	N	O
1.	m	N	N	O
割	v	N	N	O
边	d	N	N	O
，	x	N	N	O
也	d	N	N	O
就是	d	N	N	O
在	p	N	N	O
树上	s	N	N	O
的	uj	N	N	O
边	n	N	N	O
。	x	N	N	O

2.	m	N	N	O
非	d	N	N	O
割	v	N	N	O
边	d	N	N	O
，	x	N	N	O
也	d	N	N	O
就是	d	N	N	O
在	p	N	N	O
环上	n	Y	N	O
的	uj	N	N	O
边	n	N	N	O
（	x	N	N	O
双	n	N	N	O
连通	a	Y	N	O
分量	n	Y	N	O
内部	f	Y	N	O
的	uj	N	N	O
边	n	N	N	O
）	x	N	N	O
。	x	N	N	O


	x	N	N	O
对于	p	N	N	O
割	v	N	N	O
边	d	N	N	O
(	x	N	N	O
u	x	N	N	O
,	x	N	N	O
v	x	N	N	O
)	x	N	N	O
，	x	N	N	O
如果	c	N	N	O
u	eng	N	N	O
是	v	N	N	O
v	eng	N	N	O
的	uj	N	N	O
父亲	n	N	N	O
，	x	N	N	O
首先	d	N	N	O
用	p	N	N	O
F	eng	N	N	O
[	x	N	N	O
v	x	N	N	O
]	x	N	N	O
+	x	N	N	O
F	eng	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
+	x	N	N	O
w	eng	N	N	O
(	x	N	N	O
u	x	N	N	O
,	x	N	N	O
v	x	N	N	O
)	x	N	N	O
更新	d	N	N	O
ans	eng	N	N	O
，	x	N	N	O
因为	c	N	N	O
此时	c	N	N	O
还	d	N	N	O
没有	v	N	N	O
用	p	N	N	O
F	eng	N	N	O
[	x	N	N	O
v	x	N	N	O
]	x	N	N	O
更新	d	N	N	O
F	x	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
，	x	N	N	O
所以	c	N	N	O
F	x	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
一定	d	N	N	O
是从	v	N	N	O
另	r	N	N	O
一个	m	N	N	O
儿子	n	N	N	O
转移	v	N	N	O
来	v	N	N	O
的	uj	N	N	O
；	x	N	N	O
然后	c	N	N	O
再	d	N	N	O
用	p	N	N	O
F	eng	N	N	O
[	x	N	N	O
v	x	N	N	O
]	x	N	N	O
+	x	N	N	O
w	eng	N	N	O
(	x	N	N	O
u	x	N	N	O
,	x	N	N	O
v	x	N	N	O
)	x	N	N	O
更新	d	N	N	O
F	x	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
。	x	N	N	O


	x	N	N	O
对于	p	N	N	O
环上	n	Y	N	O
两点	m	N	N	O
(	x	N	N	O
u	x	N	N	O
,	x	N	N	O
v	x	N	N	O
)	x	N	N	O
，	x	N	N	O
我们	r	N	N	O
用	p	N	N	O
F	eng	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
+	x	N	N	O
F	eng	N	N	O
[	x	N	N	O
v	x	N	N	O
]	x	N	N	O
+	x	N	N	O
dist	eng	N	N	O
(	x	N	N	O
u	x	N	N	O
,	x	N	N	O
v	x	N	N	O
)	x	N	N	O
更新	d	N	N	O
ans	eng	N	N	O
，	x	N	N	O
对于	p	N	N	O
Cactus	eng	N	N	O
一题	n	N	N	O
，	x	N	N	O
还要	c	N	N	O
用	p	N	N	O
F	eng	N	N	O
[	x	N	N	O
v	x	N	N	O
]	x	N	N	O
+	x	N	N	O
dist	eng	N	N	O
(	x	N	N	O
u	x	N	N	O
,	x	N	N	O
v	x	N	N	O
)	x	N	N	O
更新	d	N	N	O
某个	r	N	N	O
环	v	N	N	O
在	p	N	N	O
DFS	eng	N	N	B-KNOWLEDGE
树上	s	N	N	O
的	uj	N	N	O
最高点	n	N	N	O
u	x	N	N	O
。	x	N	N	O


	x	N	N	O
Cactus	eng	N	N	O
这	r	N	N	O
题	n	N	N	O
，	x	N	N	O
我们	r	N	N	O
需要	v	N	N	O
在	p	N	N	O
Tarjan	eng	N	N	O
的	uj	N	N	O
过程	n	N	N	O
中	f	N	N	O
找出	v	Y	N	O
割	v	N	N	O
边	d	N	N	O
并且	c	N	N	O
用	p	N	N	O
上述	b	N	N	O
方法	n	Y	N	O
更新	d	N	N	O
，	x	N	N	O
同时	c	N	N	O
找出	v	Y	N	O
所有	b	N	N	O
的	uj	N	N	O
环	n	N	N	O
，	x	N	N	O
当	t	N	N	O
这个	r	N	N	O
环上	n	Y	N	O
的	uj	N	N	O
所有	b	N	N	O
点	m	N	N	O
的	uj	N	N	O
F	eng	N	N	O
[	x	N	N	O
]	x	N	N	O
值	n	N	N	O
都	d	N	N	O
被	p	N	N	O
更新	d	N	N	O
完	v	N	N	O
之后	f	N	N	O
，	x	N	N	O
立即	d	N	N	O
对	p	N	N	O
这个	r	N	N	O
环	v	N	N	O
进行	v	N	N	O
处理	v	N	N	O
。	x	N	N	O

具体做法	v	N	N	O
是	v	N	N	O
：	x	N	N	O
对于	p	N	N	O
一个点	m	N	N	O
x	x	N	N	O
，	x	N	N	O
如果	c	N	N	O
存在	v	N	N	O
一条	m	N	N	O
边	d	N	N	O
(	x	N	N	O
x	x	N	N	O
,	x	N	N	O
y	x	N	N	O
)	x	N	N	O
，	x	N	N	O
并且	c	N	N	O
在	p	N	N	O
DFS	eng	N	N	O
树中	s	N	N	O
x	eng	N	N	O
不是	c	N	N	O
y	eng	N	N	O
的	uj	N	N	O
父亲	n	N	N	O
，	x	N	N	O
并且	c	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
<	x	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
，	x	N	N	O
说明	v	N	N	O
x	eng	N	N	O
和	c	N	N	O
y	eng	N	N	O
是	v	N	N	O
一个	m	N	N	O
环上	n	Y	N	O
两个	m	N	N	O
相邻	v	N	N	O
的	uj	N	N	O
点	m	N	N	O
，	x	N	N	O
并且	c	N	N	O
在	p	N	N	O
DFS	eng	N	N	O
树中	s	N	N	O
二者	n	N	N	O
没有	v	N	N	O
相邻	v	N	N	O
，	x	N	N	O
因此	c	N	N	O
此时	c	N	N	O
环上	n	Y	N	O
(	x	N	N	O
x	x	N	N	O
…	x	N	N	O
…	x	N	N	O
y	x	N	N	O
)	x	N	N	O
这些	r	N	N	O
点	m	N	N	O
都	d	N	N	O
已经	d	N	N	O
DFS	eng	N	N	B-KNOWLEDGE
过	ug	N	N	O
了	ul	N	N	O
，	x	N	N	O
就	d	N	N	O
可以	c	N	N	O
对	p	N	N	O
这个	r	N	N	O
环	v	N	N	O
进行	v	N	N	O
处理	v	N	N	O
了	ul	N	N	O
。	x	N	N	O


	x	N	N	O
Island	eng	N	N	O
这	r	N	N	O
题	n	N	N	O
，	x	N	N	O
首先	d	N	N	O
遍历	v	Y	N	O
一遍	m	N	N	O
图	n	N	N	O
，	x	N	N	O
找出	v	Y	N	O
各个	r	N	N	O
连通	a	Y	N	O
分量	n	Y	N	O
并	c	N	N	O
标记	n	N	N	O
，	x	N	N	O
对于	p	N	N	O
每个	r	N	N	O
连通	a	Y	N	O
分量	n	Y	N	O
都	d	N	N	O
用	p	N	N	O
变量	vn	N	N	O
维护	v	Y	N	O
最长	a	Y	N	O
链	n	N	N	O
。	x	N	N	O

然后	c	N	N	O
利用	n	N	N	O
拓扑	v	Y	N	O
序	n	N	N	O
自	r	N	N	O
底向上	l	N	N	O
BFS	eng	N	N	O
，	x	N	N	O
处理	v	N	N	O
完	v	N	N	O
所有	b	N	N	O
的	uj	N	N	O
树边	s	N	N	O
，	x	N	N	O
此时	c	N	N	O
就	d	N	N	O
只	d	N	N	O
剩下	v	N	N	O
一个个	m	N	N	O
环	v	N	N	O
了	ul	N	N	O
。	x	N	N	O


	x	N	N	O
那么	r	N	N	O
接下来	l	N	N	O
两者	n	N	N	O
面临	v	N	N	O
的	uj	N	N	O
就是	d	N	N	O
同一个	b	N	N	O
问题	n	N	N	O
：	x	N	N	O
在	p	N	N	O
O	eng	N	N	O
(	x	N	N	O
n	x	N	N	O
)	x	N	N	O
时间	n	N	N	O
内	n	N	N	O
处理	v	N	N	O
一个	m	N	N	O
环	v	N	N	O
。	x	N	N	O


	x	N	N	O
我们	r	N	N	O
要	v	N	N	O
用到	v	N	N	O
单调	n	Y	N	B-KNOWLEDGE
队列	n	Y	N	I-KNOWLEDGE
优化	vn	Y	N	O
的	uj	N	N	O
DP	eng	N	N	B-KNOWLEDGE
。	x	N	N	O

首先	d	N	N	O
把	p	N	N	O
环	n	N	N	O
拆成	v	N	N	O
链	n	N	N	O
放到	v	N	N	O
一个	m	N	N	O
数组	n	Y	N	O
里	f	N	N	O
，	x	N	N	O
然后	c	N	N	O
把	p	N	N	O
数组	n	Y	N	O
扩大	v	N	N	O
一倍	m	N	N	O
（	x	N	N	O
也	d	N	N	O
就是	d	N	N	O
复制	v	N	N	O
一遍	m	N	N	O
接到	v	N	N	O
后边	f	N	N	O
）	x	N	N	O
，	x	N	N	O
这样	r	N	N	O
就	d	N	N	O
相当于	v	N	N	O
一个	m	N	N	O
环	v	N	N	O
了	ul	N	N	O
。	x	N	N	O

然后	c	N	N	O
对于	p	N	N	O
决策	n	N	N	O
i	eng	N	N	O
和	c	N	N	O
j	eng	N	N	O
，	x	N	N	O
当前	t	N	N	O
循环	vn	N	N	O
到	v	N	N	O
的	uj	N	N	O
点	m	N	N	O
+	x	N	N	O
1	m	N	N	O
时	n	N	N	O
，	x	N	N	O
决策	n	N	N	O
i	eng	N	N	O
和	c	N	N	O
j	eng	N	N	O
距离	n	Y	N	O
当前	t	N	N	O
循环	vn	N	N	O
到	v	N	N	O
的	uj	N	N	O
点	m	N	N	O
的	uj	N	N	O
距离	n	Y	N	O
同时	c	N	N	O
+	x	N	N	O
1	m	N	N	O
，	x	N	N	O
因此	c	N	N	O
如果	c	N	N	O
某	r	N	N	O
时刻	n	N	N	O
i	eng	N	N	O
比	p	N	N	O
j	eng	N	N	O
优	n	N	N	O
，	x	N	N	O
那么	r	N	N	O
下	f	N	N	O
一	m	N	N	O
时刻	n	N	N	O
i	x	N	N	O
仍然	d	N	N	O
比	p	N	N	O
j	eng	N	N	O
优	n	N	N	O
，	x	N	N	O
所以	c	N	N	O
决策	n	N	N	O
单调	n	Y	N	O
。	x	N	N	O

跟	p	N	N	O
据	p	N	N	O
题目	n	Y	N	O
的	uj	N	N	O
不同	a	N	N	O
要留	v	N	N	O
，	x	N	N	O
Cactus	eng	N	N	O
这	r	N	N	O
题	n	N	N	O
当	p	N	N	O
队头	n	N	N	O
决策	n	N	N	O
和	c	N	N	O
当前	t	N	N	O
点	m	N	N	O
相距	v	N	N	O
超过	v	N	N	O
半个	m	N	N	O
环长	n	N	N	O
时	n	N	N	O
删掉	v	N	N	O
队头	n	N	N	O
，	x	N	N	O
Island	eng	N	N	O
这	r	N	N	O
题	n	N	N	O
相距	v	N	N	O
达到	v	N	N	O
一个	m	N	N	O
环长	n	N	N	O
时	n	N	N	O
删掉	v	N	N	O
队头	n	N	N	O
决策	n	N	N	O
。	x	N	N	O


	x	N	N	O
具体	a	N	N	O
问题	n	N	N	O
详见	a	N	N	O
代码	n	N	N	O
，	x	N	N	O
代码	n	N	N	O
还是	c	N	N	O
比较	d	N	N	O
容易	a	N	N	O
看懂	v	N	N	O
的	uj	N	N	O
，	x	N	N	O
代码	n	N	N	O
长度	ns	Y	N	O
两道	m	N	N	O
题	n	N	N	O
都	d	N	N	O
排	v	N	N	O
第一	m	N	N	O
。	x	N	N	O
。	x	N	N	O


	x	N	N	O
POJ3567	eng	N	Y	B-OJ
 	x	N	N	O
/	x	N	N	O
 	x	N	N	O
Bzoj1023	eng	N	Y	B-OJ
 	x	N	N	O
Cactus	eng	N	N	O

	x	N	N	O
#	x	N	N	O
include	eng	N	N	O
<	x	N	N	O
iostream	eng	N	N	O
>	x	N	N	O

	x	N	N	O
#	x	N	N	O
include	eng	N	N	O
<	x	N	N	O
cstdio	eng	N	N	O
>	x	N	N	O

	x	N	N	O
using	eng	N	N	O
 	x	N	N	O
namespace	eng	N	N	O
 	x	N	N	O
std	eng	N	N	O
;	x	N	N	O

	x	N	N	O
const	eng	N	N	O
 	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
u	x	N	N	O
=	x	N	N	O
50010	m	N	N	O
,	x	N	N	O
w	x	N	N	O
=	x	N	N	O
200010	m	N	N	O
;	x	N	N	O

	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
w	x	N	N	O
]	x	N	N	O
,	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
w	x	N	N	O
]	x	N	N	O
,	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
low	eng	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
fa	eng	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
f	x	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
q	x	N	N	O
[	x	N	N	O
u	x	N	N	O
*	x	N	N	O
2	x	N	N	O
]	x	N	N	O
,	x	N	N	O
a	x	N	N	O
[	x	N	N	O
u	x	N	N	O
*	x	N	N	O
2	x	N	N	O
]	x	N	N	O
;	x	N	N	O

	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
n	x	N	N	O
,	x	N	N	O
m	x	N	N	O
,	x	N	N	O
tot	eng	N	N	O
,	x	N	N	O
num	eng	N	N	O
,	x	N	N	O
ans	eng	N	N	O
,	x	N	N	O
i	x	N	N	O
,	x	N	N	O
j	x	N	N	O
,	x	N	N	O
k	x	N	N	O
,	x	N	N	O
x	x	N	N	O
,	x	N	N	O
y	x	N	N	O
;	x	N	N	O

	x	N	N	O
void	eng	N	N	O
 	x	N	N	O
add	eng	N	N	O
(	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
x	x	N	N	O
,	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
y	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
++	x	N	N	O
tot	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
y	x	N	N	O
;	x	N	N	O
 	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
tot	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
;	x	N	N	O
 	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
=	x	N	N	O
tot	eng	N	N	O
;	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O
void	eng	N	N	O
 	x	N	N	O
dp	eng	Y	N	O
(	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
x	x	N	N	O
,	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
y	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
m	x	N	N	O
,	x	N	N	O
i	x	N	N	O
,	x	N	N	O
l	x	N	N	O
,	x	N	N	O
r	x	N	N	O
,	x	N	N	O
p	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
m	x	N	N	O
=	x	N	N	O
0	x	N	N	O
;	x	N	N	O
y	x	N	N	O
!	x	N	N	O
=	x	N	N	O
x	x	N	N	O
;	x	N	N	O
y	x	N	N	O
=	x	N	N	O
fa	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
)	x	N	N	O
 	x	N	N	O
a	x	N	N	O
[	x	N	N	O
++	x	N	N	O
m	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
f	x	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
a	x	N	N	O
[	x	N	N	O
++	x	N	N	O
m	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
,	x	N	N	O
i	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
m	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O
 	x	N	N	O
a	x	N	N	O
[	x	N	N	O
m	eng	N	N	O
+	x	N	N	O
i	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
a	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
l	x	N	N	O
=	x	N	N	O
r	x	N	N	O
=	x	N	N	O
q	x	N	N	O
[	x	N	N	O
1	x	N	N	O
]	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
 	x	N	N	O
p	x	N	N	O
=	x	N	N	O
m	x	N	N	O
/	x	N	N	O
2	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
2	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
=	x	N	N	O
m	eng	N	N	O
+	x	N	N	O
p	eng	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
while	eng	N	N	O
(	x	N	N	O
l	x	N	N	O
<	x	N	N	O
=	x	N	N	O
r	eng	N	N	O
&&	x	N	N	O
i	eng	N	N	O
-	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
]	x	N	N	O
>	x	N	N	O
p	x	N	N	O
)	x	N	N	O
 	x	N	N	O
l	eng	N	N	O
++	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
ans	eng	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
ans	eng	N	N	O
,	x	N	N	O
a	x	N	N	O
[	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
]	x	N	N	O
]	x	N	N	O
+	x	N	N	O
a	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
+	x	N	N	O
i	eng	N	N	O
-	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
while	eng	N	N	O
(	x	N	N	O
l	x	N	N	O
<	x	N	N	O
=	x	N	N	O
r	eng	N	N	O
&&	x	N	N	O
a	eng	N	N	O
[	x	N	N	O
q	x	N	N	O
[	x	N	N	O
r	x	N	N	O
]	x	N	N	O
]	x	N	N	O
+	x	N	N	O
i	eng	N	N	O
-	x	N	N	O
q	x	N	N	O
[	x	N	N	O
r	x	N	N	O
]	x	N	N	O
<	x	N	N	O
=	x	N	N	O
a	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O
 	x	N	N	O
r	x	N	N	O
-	x	N	N	O
-	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
q	x	N	N	O
[	x	N	N	O
++	x	N	N	O
r	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
i	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
m	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O
 	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
,	x	N	N	O
a	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
+	x	N	N	O
min	eng	N	N	O
(	x	N	N	O
i	x	N	N	O
,	x	N	N	O
m	x	N	N	O
-	x	N	N	O
i	x	N	N	O
)	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O
void	eng	N	N	O
 	x	N	N	O
tarjan	eng	Y	N	O
(	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
x	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
=	x	N	N	O
low	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
=	x	N	N	O
++	x	N	N	O
num	eng	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
i	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
;	x	N	N	O
i	x	N	N	O
;	x	N	N	O
i	x	N	N	O
=	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
fa	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
!	x	N	N	O
=	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
!	x	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
fa	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
=	x	N	N	O
x	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
tarjan	eng	Y	N	O
(	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
low	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
=	x	N	N	O
min	eng	N	N	O
(	x	N	N	O
low	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
,	x	N	N	O
low	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
<	x	N	N	O
low	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
ans	eng	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
ans	eng	N	N	O
,	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
+	x	N	N	O
f	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
+	x	N	N	O
1	m	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
,	x	N	N	O
f	x	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
+	x	N	N	O
1	m	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
else	eng	N	N	O
 	x	N	N	O
low	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
=	x	N	N	O
min	eng	N	N	O
(	x	N	N	O
low	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
,	x	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
i	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
;	x	N	N	O
i	x	N	N	O
;	x	N	N	O
i	x	N	N	O
=	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
fa	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
!	x	N	N	O
=	x	N	N	O
x	eng	N	N	O
&&	x	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
<	x	N	N	O
dfn	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
)	x	N	N	O
 	x	N	N	O
dp	eng	Y	N	O
(	x	N	N	O
x	x	N	N	O
,	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
main	eng	N	N	O
(	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
cin	eng	N	N	O
>	x	N	N	O
>	x	N	N	O
n	x	N	N	O
>	x	N	N	O
>	x	N	N	O
m	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
=	x	N	N	O
m	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
scanf	eng	N	N	O
(	x	N	N	O
"	x	N	N	O
%	x	N	N	O
d	x	N	N	O
%	x	N	N	O
d	x	N	N	O
"	x	N	N	O
,	x	N	N	O
&	x	N	N	O
k	eng	N	N	O
,	x	N	N	O
&	x	N	N	O
x	eng	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
j	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
j	x	N	N	O
<	x	N	N	O
k	x	N	N	O
;	x	N	N	O
j	eng	N	N	O
++	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
scanf	eng	N	N	O
(	x	N	N	O
"	x	N	N	O
%	x	N	N	O
d	x	N	N	O
"	x	N	N	O
,	x	N	N	O
&	x	N	N	O
y	eng	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
add	eng	N	N	O
(	x	N	N	O
x	x	N	N	O
,	x	N	N	O
y	x	N	N	O
)	x	N	N	O
;	x	N	N	O
 	x	N	N	O
add	eng	N	N	O
(	x	N	N	O
y	x	N	N	O
,	x	N	N	O
x	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
x	x	N	N	O
=	x	N	N	O
y	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
tarjan	eng	Y	N	O
(	x	N	N	O
1	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
cout	eng	N	N	O
<	x	N	N	O
<	x	N	N	O
ans	eng	N	N	O
<	x	N	N	O
<	x	N	N	O
endl	eng	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
return	eng	N	N	O
 	x	N	N	O
0	x	N	N	O
;	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
Bzoj1791	eng	N	Y	B-OJ
 	x	N	N	O
[	x	N	N	O
IOI2008	eng	N	N	O
]	x	N	N	O
 	x	N	N	O
Island	eng	N	N	O

	x	N	N	O
#	x	N	N	O
include	eng	N	N	O
<	x	N	N	O
iostream	eng	N	N	O
>	x	N	N	O

	x	N	N	O
#	x	N	N	O
include	eng	N	N	O
<	x	N	N	O
cstdio	eng	N	N	O
>	x	N	N	O

	x	N	N	O
using	eng	N	N	O
 	x	N	N	O
namespace	eng	N	N	O
 	x	N	N	O
std	eng	N	N	O
;	x	N	N	O

	x	N	N	O
const	eng	N	N	O
 	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
u	x	N	N	O
=	x	N	N	O
1000010	m	N	N	O
;	x	N	N	O

	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
2	x	N	N	O
*	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
edge	eng	N	N	O
[	x	N	N	O
2	x	N	N	O
*	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
2	x	N	N	O
*	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
du	eng	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
c	x	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
v	x	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
q	x	N	N	O
[	x	N	N	O
2	x	N	N	O
*	x	N	N	O
u	x	N	N	O
]	x	N	N	O
;	x	N	N	O

	x	N	N	O
long	eng	N	N	O
 	x	N	N	O
long	eng	N	N	O
 	x	N	N	O
f	x	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
d	x	N	N	O
[	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
a	x	N	N	O
[	x	N	N	O
2	x	N	N	O
*	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
b	x	N	N	O
[	x	N	N	O
2	x	N	N	O
*	x	N	N	O
u	x	N	N	O
]	x	N	N	O
,	x	N	N	O
ans	eng	N	N	O
;	x	N	N	O

	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
n	x	N	N	O
,	x	N	N	O
m	x	N	N	O
,	x	N	N	O
tot	eng	N	N	O
,	x	N	N	O
t	x	N	N	O
,	x	N	N	O
i	x	N	N	O
,	x	N	N	O
x	x	N	N	O
,	x	N	N	O
y	x	N	N	O
;	x	N	N	O

	x	N	N	O
void	eng	N	N	O
 	x	N	N	O
add	eng	N	N	O
(	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
x	x	N	N	O
,	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
y	x	N	N	O
,	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
z	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
++	x	N	N	O
tot	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
y	x	N	N	O
;	x	N	N	O
 	x	N	N	O
edge	eng	N	N	O
[	x	N	N	O
tot	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
z	x	N	N	O
;	x	N	N	O
 	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
tot	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
;	x	N	N	O
 	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
=	x	N	N	O
tot	eng	N	N	O
;	x	N	N	O
 	x	N	N	O
du	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
++	x	N	N	O
;	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O
void	eng	N	N	O
 	x	N	N	O
bfs	eng	N	N	O
(	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
s	x	N	N	O
,	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
t	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
l	x	N	N	O
,	x	N	N	O
r	x	N	N	O
,	x	N	N	O
i	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
=	x	N	N	O
r	x	N	N	O
=	x	N	N	O
1	x	N	N	O
]	x	N	N	O
=	x	N	N	O
s	x	N	N	O
;	x	N	N	O
 	x	N	N	O
c	x	N	N	O
[	x	N	N	O
s	x	N	N	O
]	x	N	N	O
=	x	N	N	O
t	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
while	eng	N	N	O
(	x	N	N	O
l	x	N	N	O
<	x	N	N	O
=	x	N	N	O
r	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
]	x	N	N	O
]	x	N	N	O
;	x	N	N	O
i	x	N	N	O
;	x	N	N	O
i	x	N	N	O
=	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
!	x	N	N	O
c	x	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
)	x	N	N	O
 	x	N	N	O
{	x	N	N	O
q	x	N	N	O
[	x	N	N	O
++	x	N	N	O
r	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
;	x	N	N	O
 	x	N	N	O
c	x	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
=	x	N	N	O
t	x	N	N	O
;	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
l	eng	N	N	O
++	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O
void	eng	N	N	O
 	x	N	N	O
topsort	eng	N	N	O
(	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
l	x	N	N	O
=	x	N	N	O
1	x	N	N	O
,	x	N	N	O
r	x	N	N	O
=	x	N	N	O
0	x	N	N	O
,	x	N	N	O
i	x	N	N	O
,	x	N	N	O
x	x	N	N	O
,	x	N	N	O
y	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
=	x	N	N	O
n	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
du	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
=	x	N	N	O
=	x	N	N	O
1	x	N	N	O
)	x	N	N	O
 	x	N	N	O
q	x	N	N	O
[	x	N	N	O
++	x	N	N	O
r	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
i	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
while	eng	N	N	O
(	x	N	N	O
l	x	N	N	O
<	x	N	N	O
=	x	N	N	O
r	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
x	x	N	N	O
=	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
]	x	N	N	O
]	x	N	N	O
;	x	N	N	O
i	x	N	N	O
;	x	N	N	O
i	x	N	N	O
=	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
du	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
=	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
>	x	N	N	O
1	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
d	x	N	N	O
[	x	N	N	O
c	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
]	x	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
d	x	N	N	O
[	x	N	N	O
c	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
]	x	N	N	O
,	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
+	x	N	N	O
f	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
+	x	N	N	O
edge	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
f	x	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
f	x	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
,	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
+	x	N	N	O
edge	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
(	x	N	N	O
-	x	N	N	O
-	x	N	N	O
du	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
)	x	N	N	O
=	x	N	N	O
=	x	N	N	O
1	x	N	N	O
)	x	N	N	O
 	x	N	N	O
q	x	N	N	O
[	x	N	N	O
++	x	N	N	O
r	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
y	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
l	eng	N	N	O
++	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O
void	eng	N	N	O
 	x	N	N	O
dp	eng	Y	N	O
(	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
t	x	N	N	O
,	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
x	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
m	x	N	N	O
=	x	N	N	O
0	x	N	N	O
,	x	N	N	O
i	x	N	N	O
,	x	N	N	O
l	x	N	N	O
=	x	N	N	O
0	x	N	N	O
,	x	N	N	O
r	x	N	N	O
,	x	N	N	O
y	x	N	N	O
=	x	N	N	O
x	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
do	eng	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
a	x	N	N	O
[	x	N	N	O
++	x	N	N	O
m	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
f	x	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
;	x	N	N	O
 	x	N	N	O
du	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
;	x	N	N	O
i	x	N	N	O
;	x	N	N	O
i	x	N	N	O
=	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
du	eng	N	N	O
[	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
>	x	N	N	O
1	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
{	x	N	N	O
y	x	N	N	O
=	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
;	x	N	N	O
 	x	N	N	O
b	x	N	N	O
[	x	N	N	O
m	eng	N	N	O
+	x	N	N	O
1	m	N	N	O
]	x	N	N	O
=	x	N	N	O
b	x	N	N	O
[	x	N	N	O
m	x	N	N	O
]	x	N	N	O
+	x	N	N	O
edge	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
;	x	N	N	O
 	x	N	N	O
break	eng	N	N	O
;	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
}	x	N	N	O
while	eng	N	N	O
(	x	N	N	O
i	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
m	x	N	N	O
=	x	N	N	O
=	x	N	N	O
2	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
;	x	N	N	O
i	x	N	N	O
;	x	N	N	O
i	x	N	N	O
=	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
=	x	N	N	O
=	x	N	N	O
x	x	N	N	O
)	x	N	N	O
 	x	N	N	O
{	x	N	N	O
l	x	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
l	x	N	N	O
,	x	N	N	O
edge	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
d	x	N	N	O
[	x	N	N	O
t	x	N	N	O
]	x	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
d	x	N	N	O
[	x	N	N	O
t	x	N	N	O
]	x	N	N	O
,	x	N	N	O
f	x	N	N	O
[	x	N	N	O
x	x	N	N	O
]	x	N	N	O
+	x	N	N	O
f	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
+	x	N	N	O
l	eng	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
return	eng	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
head	eng	N	N	O
[	x	N	N	O
y	x	N	N	O
]	x	N	N	O
;	x	N	N	O
i	x	N	N	O
;	x	N	N	O
i	x	N	N	O
=	x	N	N	O
next	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
ver	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
=	x	N	N	O
=	x	N	N	O
x	x	N	N	O
)	x	N	N	O
 	x	N	N	O
{	x	N	N	O
b	x	N	N	O
[	x	N	N	O
m	eng	N	N	O
+	x	N	N	O
1	m	N	N	O
]	x	N	N	O
=	x	N	N	O
b	x	N	N	O
[	x	N	N	O
m	x	N	N	O
]	x	N	N	O
+	x	N	N	O
edge	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
;	x	N	N	O
 	x	N	N	O
break	eng	N	N	O
;	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
m	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O
 	x	N	N	O
{	x	N	N	O
a	x	N	N	O
[	x	N	N	O
m	eng	N	N	O
+	x	N	N	O
i	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
a	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
;	x	N	N	O
 	x	N	N	O
b	x	N	N	O
[	x	N	N	O
m	eng	N	N	O
+	x	N	N	O
i	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
b	x	N	N	O
[	x	N	N	O
m	eng	N	N	O
+	x	N	N	O
1	m	N	N	O
]	x	N	N	O
+	x	N	N	O
b	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
;	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
=	x	N	N	O
r	x	N	N	O
=	x	N	N	O
1	x	N	N	O
]	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
2	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
2	x	N	N	O
*	x	N	N	O
m	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
while	eng	N	N	O
(	x	N	N	O
l	x	N	N	O
<	x	N	N	O
=	x	N	N	O
r	eng	N	N	O
&&	x	N	N	O
i	eng	N	N	O
-	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
]	x	N	N	O
>	x	N	N	O
=	x	N	N	O
m	x	N	N	O
)	x	N	N	O
 	x	N	N	O
l	eng	N	N	O
++	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
d	x	N	N	O
[	x	N	N	O
t	x	N	N	O
]	x	N	N	O
=	x	N	N	O
max	eng	N	N	O
(	x	N	N	O
d	x	N	N	O
[	x	N	N	O
t	x	N	N	O
]	x	N	N	O
,	x	N	N	O
a	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
+	x	N	N	O
a	eng	N	N	O
[	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
]	x	N	N	O
]	x	N	N	O
+	x	N	N	O
b	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
-	x	N	N	O
b	x	N	N	O
[	x	N	N	O
q	x	N	N	O
[	x	N	N	O
l	x	N	N	O
]	x	N	N	O
]	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
while	eng	N	N	O
(	x	N	N	O
l	x	N	N	O
<	x	N	N	O
=	x	N	N	O
r	eng	N	N	O
&&	x	N	N	O
a	eng	N	N	O
[	x	N	N	O
q	x	N	N	O
[	x	N	N	O
r	x	N	N	O
]	x	N	N	O
]	x	N	N	O
+	x	N	N	O
b	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
-	x	N	N	O
b	x	N	N	O
[	x	N	N	O
q	x	N	N	O
[	x	N	N	O
r	x	N	N	O
]	x	N	N	O
]	x	N	N	O
<	x	N	N	O
=	x	N	N	O
a	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O
 	x	N	N	O
r	x	N	N	O
-	x	N	N	O
-	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
q	x	N	N	O
[	x	N	N	O
++	x	N	N	O
r	eng	N	N	O
]	x	N	N	O
=	x	N	N	O
i	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O
int	eng	N	N	O
 	x	N	N	O
main	eng	N	N	O
(	x	N	N	O
)	x	N	N	O

	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
cin	eng	N	N	O
>	x	N	N	O
>	x	N	N	O
n	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
=	x	N	N	O
n	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
scanf	eng	N	N	O
(	x	N	N	O
"	x	N	N	O
%	x	N	N	O
d	x	N	N	O
%	x	N	N	O
d	x	N	N	O
"	x	N	N	O
,	x	N	N	O
&	x	N	N	O
x	eng	N	N	O
,	x	N	N	O
&	x	N	N	O
y	eng	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
add	eng	N	N	O
(	x	N	N	O
i	x	N	N	O
,	x	N	N	O
x	x	N	N	O
,	x	N	N	O
y	x	N	N	O
)	x	N	N	O
;	x	N	N	O
 	x	N	N	O
add	eng	N	N	O
(	x	N	N	O
x	x	N	N	O
,	x	N	N	O
i	x	N	N	O
,	x	N	N	O
y	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
=	x	N	N	O
n	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
!	x	N	N	O
c	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
)	x	N	N	O
 	x	N	N	O
bfs	eng	N	N	O
(	x	N	N	O
i	x	N	N	O
,	x	N	N	O
++	x	N	N	O
t	eng	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
topsort	eng	N	N	O
(	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
for	eng	Y	N	O
(	x	N	N	O
i	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O
i	x	N	N	O
<	x	N	N	O
=	x	N	N	O
n	x	N	N	O
;	x	N	N	O
i	eng	N	N	O
++	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
if	eng	N	N	O
(	x	N	N	O
du	eng	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
>	x	N	N	O
1	m	N	N	O
&&	x	N	N	O
!	x	N	N	O
v	x	N	N	O
[	x	N	N	O
c	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
)	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
{	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
v	x	N	N	O
[	x	N	N	O
c	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
=	x	N	N	O
1	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
dp	eng	Y	N	O
(	x	N	N	O
c	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
,	x	N	N	O
i	x	N	N	O
)	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
 	x	N	N	O
ans	eng	N	N	O
+	x	N	N	O
=	x	N	N	O
d	x	N	N	O
[	x	N	N	O
c	x	N	N	O
[	x	N	N	O
i	x	N	N	O
]	x	N	N	O
]	x	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
 	x	N	N	O
}	x	N	N	O

	x	N	N	O
 	x	N	N	O
cout	eng	N	N	O
<	x	N	N	O
<	x	N	N	O
ans	eng	N	N	O
<	x	N	N	O
<	x	N	N	O
endl	eng	N	N	O
;	x	N	N	O

	x	N	N	O
 	x	N	N	O
return	eng	N	N	O
 	x	N	N	O
0	x	N	N	O
;	x	N	N	O

	x	N	N	O
}	x	N	N	O

	x	N	N	O